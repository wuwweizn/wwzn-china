<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>YesPlayMusic</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
        }
        .container {
            text-align: center;
            max-width: 500px;
            padding: 2rem;
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }
        .logo { font-size: 4rem; margin-bottom: 1rem; }
        .title { font-size: 2.5rem; margin-bottom: 1rem; font-weight: 300; }
        .subtitle { font-size: 1.2rem; opacity: 0.8; margin-bottom: 2rem; }
        .status {
            background: rgba(255,255,255,0.2);
            padding: 1rem;
            border-radius: 10px;
            margin: 1rem 0;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-right: 0.5rem;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .features {
            text-align: left;
            margin: 2rem 0;
            background: rgba(255,255,255,0.1);
            padding: 1.5rem;
            border-radius: 10px;
        }
        .features h3 {
            margin-bottom: 1rem;
            text-align: center;
        }
        .features ul {
            list-style: none;
        }
        .features li {
            margin: 0.5rem 0;
            padding-left: 1rem;
            position: relative;
        }
        .features li::before {
            content: "✅";
            position: absolute;
            left: 0;
        }
        .btn {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 0.8rem 1.5rem;
            border-radius: 25px;
            cursor: pointer;
            margin: 0.5rem;
            text-decoration: none;
            display: inline-block;
            transition: all 0.3s ease;
        }
        .btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }
        .api-status {
            font-size: 0.9rem;
            opacity: 0.7;
            margin-top: 1rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">🎵</div>
        <h1 class="title">YesPlayMusic</h1>
        <p class="subtitle">高颜值的第三方网易云播放器</p>
        
        <div class="status" id="status">
            <div class="loading"></div>
            正在启动音乐服务...
        </div>
        
        <div class="features">
            <h3>🎶 功能特色</h3>
            <ul>
                <li>网易云账号登录</li>
                <li>支持 MV 播放</li>
                <li>歌词显示</li>
                <li>私人 FM / 每日推荐</li>
                <li>音乐云盘</li>
                <li>深色/浅色主题</li>
                <li>无社交功能干扰</li>
                <li>支持海外访问</li>
            </ul>
        </div>
        
        <div>
            <a href="#" onclick="checkService()" class="btn">🔄 重新检查服务</a>
            <a href="/api/ping" target="_blank" class="btn">🔗 测试API连接</a>
        </div>
        
        <div class="api-status" id="api-status">
            API状态: 检查中...
        </div>
    </div>

    <script>
        let checkCount = 0;
        const maxChecks = 30;
        
        function checkService() {
            checkCount++;
            const status = document.getElementById('status');
            const apiStatus = document.getElementById('api-status');
            
            // 检查主应用
            fetch('/')
                .then(response => {
                    if (response.ok) {
                        const html = response.text();
                        return html;
                    }
                    throw new Error('Service not ready');
                })
                .then(html => {
                    if (html && html.includes('YesPlayMusic') && html.length > 1000) {
                        status.innerHTML = '✅ 服务已启动，正在跳转...';
                        setTimeout(() => {
                            window.location.reload();
                        }, 2000);
                        return;
                    }
                    throw new Error('App not fully loaded');
                })
                .catch(error => {
                    if (checkCount < maxChecks) {
                        status.innerHTML = `<div class="loading"></div>服务启动中... (${checkCount}/${maxChecks})`;
                        setTimeout(checkService, 2000);
                    } else {
                        status.innerHTML = '⚠️ 服务启动超时，请检查配置或重启加载项';
                    }
                });
            
            // 检查API
            fetch('/api/ping')
                .then(response => {
                    if (response.ok) {
                        apiStatus.innerHTML = 'API状态: ✅ 连接正常';
                    } else {
                        apiStatus.innerHTML = 'API状态: ⚠️ 连接异常';
                    }
                })
                .catch(error => {
                    apiStatus.innerHTML = 'API状态: ❌ 连接失败';
                });
        }
        
        // 页面加载后开始检查
        setTimeout(checkService, 1000);
        
        // 定期检查服务状态
        const interval = setInterval(() => {
            if (checkCount >= maxChecks) {
                clearInterval(interval);
            } else {
                checkService();
            }
        }, 5000);
    </script>
</body>
</html>