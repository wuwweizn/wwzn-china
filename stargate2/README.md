# Home Assistant 插件：星际之门 · StarGate（备选）

[![版本](https://img.shields.io/badge/版本-2.2.5.1-blue.svg)](CHANGELOG.md)
[![架构](https://img.shields.io/badge/架构-amd64%20%7C%20aarch64-green.svg)]()

## 关于

星际之门 · StarGate（备选）是首选版本的功能补充，底层采用不同的代理实现方案。相比首选版本，其 DNS 分流规则配置更为简单直接，适合对网络分流需求不高、或首选版本无法正常使用时作为替代。

**支持架构：** `amd64` / `aarch64`

---

## 与首选版本的区别

| 对比项 | 首选版本 | 备选版本（本插件）|
|--------|---------|----------------|
| DNS 分流配置 | 功能完整，支持自定义规则 | 较简单，开箱即用 |
| 新协议支持 | 对 VLESS+REALITY 等支持有限 | 支持更多新协议 |
| 适用场景 | 日常主力使用 | 首选版不可用时的替代 |
| TUN 模式 | 支持 v1/v2 | redirect / system tun 两种模式 |

> **建议：** 优先使用首选版本；若首选版本无法使用，或需要使用 VLESS+REALITY 等新协议，再切换至本插件。

---

## 使用须知

- 支持官方 HAOS 系统（amd64 / aarch64），部分原版 aarch64 内核设备功能可能不完整。
- **redirect 模式**：兼容性强，但只适合临时短时使用（如下载配置），不建议长期运行。
- **system tun 模式**：可长期稳定使用，但需要注意正确配置主机的 DNS 设置，避免 DNS 泄漏。
- 此插件只能在 HA **完全启动后**才能生效，对首次安装无法提供加速。
- 本插件需要**配合第三方代理订阅**使用。
- 由于各地 ISP 网络环境不同，特定地区可能无法正常使用。

---

## 首次配置与使用

### 第一步：启动插件

在 HA 插件页面启动本插件（此时代理服务尚未运行）。

### 第二步：进入 Web 控制台

在浏览器打开：

```
http://<你的HA主机IP>:2017
```

### 第三步：初始化设置

1. **注册用户名和密码**（请妥善保存）
2. 进入顶部菜单「**设置**」
3. 关闭「开启 IP 转发」
4. 打开「开机端口分享」
5. 在设置页面完成「透明代理实现方式」「DNS 模式」「防火墙模式」这三项配置
6. 点击左上角「**启动**」按钮，启动代理服务

### 第四步：导入订阅

在控制台中导入你的 v2ray / xray 订阅链接，选择节点后即可使用。

> 更多进阶功能，请参考 [v2rayA 官方文档](https://v2raya.org/docs/prologue/introduction/)。

---

## 启动后验证

在 HA 终端（Terminal 插件）中运行：

```bash
# 查看当前出口 IP 信息
curl ipinfo.io

# 测试目标网站的 HTTP 响应状态码
curl -sL -o /dev/null -w "%{http_code}" https://www.google.com
```

---

## 常见问题

**Q：system tun 模式下 DNS 无法解析？**
需要在 HA 主机的 DNS 设置中，将 DNS 服务器改为 `127.0.0.1`（v2rayA 内置 DNS），避免 DNS 查询绕过代理。

**Q：redirect 模式使用一段时间后断开？**
redirect 模式设计上仅适合短暂使用，长期稳定运行请切换为 system tun 模式。

**Q：首选版本能用，是否需要安装备选版本？**
不需要，两者功能相近，同时运行可能产生端口冲突。建议只运行其中一个。
