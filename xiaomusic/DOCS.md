# XiaoMusic 使用文档

## 目录

- [初始配置](#初始配置)
- [音乐目录说明](#音乐目录说明)
- [语音口令大全](#语音口令大全)
- [网络歌单配置](#网络歌单配置)
- [常见问题](#常见问题)

---

## 初始配置

加载项启动后，点击侧边栏的 **XiaoMusic** 或访问 `http://homeassistant.local:58090` 打开管理界面。

**必填项（带 `*` 号）：**

| 配置项 | 说明 |
|--------|------|
| 小米账号 `*` | 登录小米/小爱的账号（手机号或邮箱）|
| 小米密码 `*` | 对应账号的密码 |
| 设备列表 | 填写账号密码保存后自动获取，选择你的音箱设备 |
| 公网端口 | 默认 `58090`，与加载项配置保持一致 |
| 音乐目录 | 默认 `/media`，对应 HA 的媒体库目录 |

> ⚠️ 如果你的小米账号绑定了摄像头，强烈建议使用专用账号，防止账号信息泄露导致隐私风险。

---

## 音乐目录说明

本加载项将 HA 的 `/media` 目录挂载为音乐目录。

**添加本地音乐的方法：**

1. 在 HA 中安装 **File Editor** 或 **Samba** 加载项
2. 将音乐文件（mp3/flac/wav 等）上传到 `/media` 目录下的任意子文件夹
3. 在 XiaoMusic 管理界面点击 **刷新列表**，或对小爱说"**刷新列表**"

**目录与歌单的关系：**

- `/media` 下的每个**子文件夹**会自动识别为一个**播放列表**
- 例如 `/media/周杰伦/` 文件夹会生成名为"周杰伦"的歌单
- 可以对小爱说"**播放列表周杰伦**"来播放该歌单

---

## 语音口令大全

### 基础播放控制

| 口令 | 说明 |
|------|------|
| 播放歌曲 | 随机播放所有音乐 |
| 播放歌曲 + 歌名 | 如"播放歌曲晴天"，本地有则直接播，没有则下载后播放 |
| 上一首 | 切换到上一首 |
| 下一首 | 切换到下一首 |
| 停止播放 / 关机 | 停止播放 |

### 播放模式

| 口令 | 说明 |
|------|------|
| 单曲循环 | 循环播放当前歌曲 |
| 全部循环 | 顺序循环播放 |
| 随机播放 | 随机顺序播放 |

### 歌单操作

| 口令 | 说明 |
|------|------|
| 播放列表 + 列表名 | 如"播放列表其他" |
| 刷新列表 | 扫描音乐目录更新歌单 |
| 加入收藏 | 将当前播放歌曲加入收藏歌单 |
| 取消收藏 | 从收藏歌单中移除当前歌曲 |
| 播放列表收藏 | 播放收藏歌单 |

### 搜索播放

| 口令 | 说明 |
|------|------|
| 搜索播放 + 关键词 | 如"搜索播放林俊杰"，搜索本地及在线资源并播放 |
| 本地搜索播放 + 关键词 | 只搜索本地，不触发下载 |

---

## 网络歌单配置

XiaoMusic 支持配置 JSON 格式的网络歌单，可包含在线电台和歌曲链接。

**格式示例：**

```json
[
  {
    "name": "古典电台",
    "type": "radio",
    "url": "http://example.com/stream.m3u8"
  },
  {
    "name": "我的最爱",
    "type": "playlist",
    "songs": [
      {"name": "歌曲名", "url": "http://example.com/song.mp3"}
    ]
  }
]
```

在管理界面的**网络歌单**配置项中填入 JSON 文件的 URL 或直接粘贴内容即可。

---

## 常见问题

**Q：音箱无响应，日志提示登录失败？**  
A：检查小米账号密码是否正确。如开启了二步验证，需先在手机上完成一次登录授权。

**Q：说"播放歌曲"没有声音？**  
A：确认音乐目录（`/media`）下有音乐文件，并在管理界面点击**刷新列表**后重试。

**Q：flac 格式无法播放？**  
A：部分型号（L05B/L05C/LX06/L16A）不支持 flac，在管理界面开启**转换为 MP3** 和**型号兼容模式**选项。

**Q：触屏版音箱无法播放？**  
A：在管理界面开启**型号兼容模式**选项。

**Q：如何下载日志排查问题？**  
A：进入 XiaoMusic 管理界面底部，点击**下载日志文件**，检查日志内容时注意删除账号密码等敏感信息后再提交反馈。

**Q：公网端口怎么配置？**  
A：本加载项默认映射端口为 `58090`，如需修改请同时修改加载项配置中的端口映射和管理界面中的**公网端口**设置，保持一致。

---

更多问题请参考原项目 FAQ：[https://github.com/hanxi/xiaomusic/issues/99](https://github.com/hanxi/xiaomusic/issues/99)
